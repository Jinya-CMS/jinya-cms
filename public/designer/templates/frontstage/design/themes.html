<div class="cosmo-side-list" x-data="themesData">
  <nav class="cosmo-side-list__items">
    <template x-for="theme in themes" :key="theme.id">
      <a x-text="getValueForCurrentLanguage(theme.displayName)"
         class="cosmo-side-list__item"
         :class="{ 'is--active': selectedTheme?.id === theme.id }"
         @click="selectTheme(theme)"></a>
    </template>
    <button class="cosmo-button is--full-width" x-localize:design-themes-action-create
            @click="openCreateDialog"></button>
  </nav>
  <template x-if="themeSelected">
    <div class="cosmo-side-list__content is--theme">
      <div class="jinya-designer__title">
        <span class="cosmo-title" x-text="title"></span>
      </div>
      <div class="jinya-designer__content is--theme">
        <div class="cosmo-tab is--theme">
          <div class="cosmo-tab__links">
            <a @click="activeTab = 'details'" :class="{ 'is--active': activeTab === 'details' }" class="cosmo-tab__link"
               x-localize:design-themes-tabs-details></a>
            <a @click="activeTab = 'configuration'" :class="{ 'is--active': activeTab === 'configuration' }"
               class="cosmo-tab__link" x-localize:design-themes-tabs-configuration></a>
            <a @click="activeTab = 'links'" :class="{ 'is--active': activeTab === 'links' }" class="cosmo-tab__link"
               x-localize:design-themes-tabs-links></a>
            <a @click="activeTab = 'variables'" :class="{ 'is--active': activeTab === 'variables' }"
               class="cosmo-tab__link" x-localize:design-themes-tabs-variables></a>
          </div>
          <div class="cosmo-tab__content is--details is--theme" x-show="activeTab === 'details'">
            <div class="cosmo-toolbar is--designer">
              <div class="cosmo-toolbar__group">
                <button class="cosmo-button" x-localize:design-themes-action-activate @click="activate"></button>
                <button class="cosmo-button" x-localize:design-themes-action-compile_assets
                        @click="compileAssets"></button>
                <button class="cosmo-button" x-localize:design-themes-action-update @click="openEditDialog"></button>
              </div>
            </div>
            <template x-if="details.message.hasMessage">
              <div class="cosmo-message is--details is--theme"
                   :class="{ 'is--negative': details.message.hasError, 'is--positive': !details.message.hasError }">
                <span class="cosmo-message__header" x-text="details.message.title"></span>
                <div class="cosmo-message__message" x-text="details.message.content"></div>
              </div>
            </template>
            <img class="jinya-theme-details__preview" :alt="selectedThemeDisplayName"
                 :src="selectedThemePreviewImage" />
            <div class="jinya-theme-details__description" x-html="selectedThemeDescription"></div>
          </div>
          <form class="cosmo-tab__content is--theme" x-show="activeTab === 'configuration'"
                @submit.prevent="saveConfiguration">
            <template x-if="configuration.message.hasMessage">
              <div class="cosmo-message"
                   :class="{ 'is--negative': configuration.message.hasError, 'is--positive': !configuration.message.hasError }">
                <span class="cosmo-message__header" x-text="configuration.message.title"></span>
                <div class="cosmo-message__message" x-text="configuration.message.content"></div>
              </div>
            </template>
            <div class="cosmo-input__group">
              <template x-for="group in selectedThemeData.configurationStructure.groups" :key="group.name">
                <div style="display: contents">
                  <span class="cosmo-input__header" x-text="getValueForCurrentLanguage(group.title)"></span>
                  <template x-for="field in group.fields" x-data="{ id: $id('group') }" :key="field.name">
                    <div style="display: contents">
                      <template x-if="field.type !== 'boolean'">
                        <div style="display: contents">
                          <label class="cosmo-label" :for="id" x-text="getValueForCurrentLanguage(field.label)"></label>
                          <input
                            class="cosmo-input"
                            type="text"
                            x-model="selectedThemeData.configuration[group.name][field.name]"
                            :placeholder="selectedThemeData.defaultConfiguration[group.name][field.name]"
                            :id="id"
                          />
                        </div>
                      </template>
                      <template x-if="field.type === 'boolean'">
                        <div class="cosmo-input__group is--checkbox">
                          <input type="checkbox" class="cosmo-checkbox" :id="id" />
                          <label :for="id" x-text="getValueForCurrentLanguage(field.label)"></label>
                        </div>
                      </template>
                    </div>
                  </template>
                </div>
              </template>
            </div>
            <div class="cosmo-button__container is--sticky-bottom">
              <button type="reset" class="cosmo-button" x-localize:design-themes-configuration-discard
                      @click="loadThemeConfiguration"></button>
              <button type="submit" class="cosmo-button is--primary"
                      x-localize:design-themes-configuration-save></button>
            </div>
          </form>
          <form class="cosmo-tab__content is--theme" x-show="activeTab === 'links'" @submit.prevent="saveLinks">
            <template x-if="links.message.hasMessage">
              <div class="cosmo-message"
                   :class="{ 'is--negative': links.message.hasError, 'is--positive': !links.message.hasError }">
                <span class="cosmo-message__header" x-text="links.message.title"></span>
                <div class="cosmo-message__message" x-text="links.message.content"></div>
              </div>
            </template>
            <div class="cosmo-input__group">
              <template x-if="selectedThemeData.configurationStructure.links.menus">
                <div style="display: contents">
                  <span class="cosmo-input__header" x-localize:design-themes-links-menus></span>
                  <template
                    x-for="[menuLink, label] in Object.entries(selectedThemeData.configurationStructure.links.menus)">
                    <div style="display: contents" x-data="{ id: $id('group') }">
                      <label :for="id" class="cosmo-label" x-text="getValueForCurrentLanguage(label)"></label>
                      <select :id="id" class="cosmo-select" x-model.number="selectedThemeData.menus[menuLink]">
                        <option :value="null" x-localize:design-themes-links-no_menu></option>
                        <template x-for="menu in menus" :key="menu.id">
                          <option x-text="menu.name" :value="menu.id"
                                  :selected="selectedThemeData.menus[menuLink] === menu.id"></option>
                        </template>
                      </select>
                    </div>
                  </template>
                </div>
              </template>
              <template x-if="selectedThemeData.configurationStructure.links.files">
                <div style="display: contents">
                  <span class="cosmo-input__header" x-localize:design-themes-links-files></span>
                  <template
                    x-for="[fileLink, label] in Object.entries(selectedThemeData.configurationStructure.links.files)">
                    <div style="display: contents" x-data="{ id: $id('group') }">
                      <label :for="id" class="cosmo-label" x-text="getValueForCurrentLanguage(label)"></label>
                      <select :id="id" class="cosmo-select" x-model.number="selectedThemeData.files[fileLink]">
                        <option :value="null" x-localize:design-themes-links-no_file></option>
                        <template x-for="file in files" :key="file.id">
                          <option x-text="file.name" :value="file.id"
                                  :selected="selectedThemeData.files[fileLink] === file.id"></option>
                        </template>
                      </select>
                    </div>
                  </template>
                </div>
              </template>
              <template x-if="selectedThemeData.configurationStructure.links.galleries">
                <div style="display: contents">
                  <span class="cosmo-input__header" x-localize:design-themes-links-galleries></span>
                  <template
                    x-for="[galleryLink, label] in Object.entries(selectedThemeData.configurationStructure.links.galleries)">
                    <div style="display: contents" x-data="{ id: $id('group') }">
                      <label :for="id" class="cosmo-label" x-text="getValueForCurrentLanguage(label)"></label>
                      <select :id="id" class="cosmo-select" x-model.number="selectedThemeData.galleries[galleryLink]">
                        <option :value="null" x-localize:design-themes-links-no_gallery></option>
                        <template x-for="gallery in galleries" :key="gallery.id">
                          <option x-text="gallery.title" :value="gallery.id"
                                  :selected="selectedThemeData.galleries[galleryLink] === gallery.id"></option>
                        </template>
                      </select>
                    </div>
                  </template>
                </div>
              </template>
              <template x-if="selectedThemeData.configurationStructure.links.classic_pages">
                <div style="display: contents">
                  <span class="cosmo-input__header" x-localize:design-themes-links-classic_pages></span>
                  <template
                    x-for="[pageLink, label] in Object.entries(selectedThemeData.configurationStructure.links.pages)">
                    <div style="display: contents" x-data="{ id: $id('group') }">
                      <label :for="id" class="cosmo-label" x-text="getValueForCurrentLanguage(label)"></label>
                      <select :id="id" class="cosmo-select" x-model.number="selectedThemeData.classicPages[pageLink]">
                        <option :value="null" x-localize:design-themes-links-no_classic_page></option>
                        <template x-for="page in classicPages" :key="page.id">
                          <option x-text="page.title" :value="page.id"
                                  :selected="selectedThemeData.pages[pageLink] === page.id"></option>
                        </template>
                      </select>
                    </div>
                  </template>
                </div>
              </template>
              <template x-if="selectedThemeData.configurationStructure.links.modern_pages">
                <div style="display: contents">
                  <span class="cosmo-input__header" x-localize:design-themes-links-modern_pages></span>
                  <template
                    x-for="[pageLink, label] in Object.entries(selectedThemeData.configurationStructure.links.modernPages)">
                    <div style="display: contents" x-data="{ id: $id('group') }">
                      <label :for="id" class="cosmo-label" x-text="getValueForCurrentLanguage(label)"></label>
                      <select :id="id" class="cosmo-select" x-model.number="selectedThemeData.modernPages[pageLink]">
                        <option :value="null" x-localize:design-themes-links-no_modern_page></option>
                        <template x-for="page in modernPages" :key="page.id">
                          <option x-text="page.name" :value="page.id"
                                  :selected="selectedThemeData.pages[pageLink] === page.id"></option>
                        </template>
                      </select>
                    </div>
                  </template>
                </div>
              </template>
              <template x-if="selectedThemeData.configurationStructure.links.blog_categories">
                <div style="display: contents">
                  <span class="cosmo-input__header" x-localize:design-themes-links-blog_categories></span>
                  <template
                    x-for="[blogCategoryLink, label] in Object.entries(selectedThemeData.configurationStructure.links.blogCategories)">
                    <div style="display: contents" x-data="{ id: $id('group') }">
                      <label :for="id" class="cosmo-label" x-text="getValueForCurrentLanguage(label)"></label>
                      <select :id="id" class="cosmo-select"
                              x-model.number="selectedThemeData.blogCategories[blogCategoryLink]">
                        <option :value="null" x-localize:design-themes-links-no_blog_category></option>
                        <template x-for="blogCategory in blogCategories" :key="blogCategory.id">
                          <option x-text="blogCategory.name" :value="blogCategory.id"
                                  :selected="selectedThemeData.blogCategories[blogCategoryLink] === blogCategory.id"></option>
                        </template>
                      </select>
                    </div>
                  </template>
                </div>
              </template>
              <template x-if="selectedThemeData.configurationStructure.links.forms">
                <div style="display: contents">
                  <span class="cosmo-input__header" x-localize:design-themes-links-forms></span>
                  <template
                    x-for="[formLink, label] in Object.entries(selectedThemeData.configurationStructure.links.forms)">
                    <div style="display: contents" x-data="{ id: $id('group') }">
                      <label :for="id" class="cosmo-label" x-text="getValueForCurrentLanguage(label)"></label>
                      <select :id="id" class="cosmo-select" x-model.number="selectedThemeData.forms[formLink]">
                        <option :value="null" x-localize:design-themes-links-no_form></option>
                        <template x-for="form in forms" :key="form.id">
                          <option x-text="form.name" :value="form.id"
                                  :selected="selectedThemeData.forms[formLink] === form.id"></option>
                        </template>
                      </select>
                    </div>
                  </template>
                </div>
              </template>
            </div>
            <div class="cosmo-button__container is--sticky-bottom">
              <button type="reset" class="cosmo-button" x-localize:design-themes-links-discard
                      @click="loadLinks"></button>
              <button type="submit" class="cosmo-button is--primary" x-localize:design-themes-links-save></button>
            </div>
          </form>
          <form class="cosmo-tab__content is--theme" x-show="activeTab === 'variables'" @submit.prevent="saveVariables">
            <template x-if="variables.message.hasMessage">
              <div class="cosmo-message"
                   :class="{ 'is--negative': variables.message.hasError, 'is--positive': !variables.message.hasError }">
                <span class="cosmo-message__header" x-text="variables.message.title"></span>
                <div class="cosmo-message__message" x-text="variables.message.content"></div>
              </div>
            </template>
            <div class="cosmo-input__group">
              <template x-for="[variable, value] in Object.entries(selectedThemeData.styleVariables)" :key="variable">
                <div style="display: contents">
                  <label :for="variable" x-text="getVariableLabel(variable)"></label>
                  <input
                    :id="variable"
                    :placeholder="value"
                    type="text"
                    class="cosmo-input"
                    x-model="selectedThemeData.scssVariables[variable]"
                  />
                  <span class="cosmo-input__message is--information"
                        x-localize:design-themes-variables-help_text="{ variable }"></span>
                </div>
              </template>
            </div>
            <div class="cosmo-button__container is--sticky-bottom">
              <button type="reset" class="cosmo-button" x-localize:design-themes-variables-discard
                      @click="loadVariables"></button>
              <button type="submit" class="cosmo-button is--primary" x-localize:design-themes-variables-save></button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </template>
  <template x-if="upload.open">
    <form class="cosmo-modal__container" @submit.prevent="uploadTheme">
      <div class="cosmo-modal">
        <h1 class="cosmo-modal__title" x-localize:design-themes-create-title></h1>
        <div class="cosmo-modal__content">
          <div class="cosmo-message is--negative" x-show="upload.error.hasError">
            <span class="cosmo-message__header" x-text="upload.error.title"></span>
            <p class="cosmo-message__message" x-text="upload.error.message"></p>
          </div>
          <div class="cosmo-input__group">
            <label for="uploadFile" class="cosmo-label"
                   x-localize:design-themes-create-file></label>
            <input required class="cosmo-input" type="file" id="uploadFile" accept="application/zip"
                   @change="upload.selectFile($event.target.files)" />
          </div>
        </div>
        <div class="cosmo-modal__button-bar">
          <button type="button" class="cosmo-button" x-localize:design-themes-create-cancel
                  @click="upload.open = false"></button>
          <button type="submit" class="cosmo-button" x-localize:design-themes-create-save></button>
        </div>
      </div>
    </form>
  </template>
  <template x-if="edit.open">
    <form class="cosmo-modal__container" @submit.prevent="updateTheme">
      <div class="cosmo-modal">
        <h1 class="cosmo-modal__title" x-localize:design-themes-edit-title></h1>
        <div class="cosmo-modal__content">
          <div class="cosmo-message is--negative" x-show="edit.error.hasError">
            <span class="cosmo-message__header" x-text="edit.error.title"></span>
            <p class="cosmo-message__message" x-text="edit.error.message"></p>
          </div>
          <div class="cosmo-input__group">
            <label for="editFile" class="cosmo-label"
                   x-localize:design-themes-edit-file></label>
            <input required class="cosmo-input" type="file" id="editFile" accept="application/zip"
                   @change="edit.selectFile($event.target.files)" />
          </div>
        </div>
        <div class="cosmo-modal__button-bar">
          <button type="button" class="cosmo-button" x-localize:design-themes-edit-cancel
                  @click="edit.open = false"></button>
          <button type="submit" class="cosmo-button" x-localize:design-themes-edit-save></button>
        </div>
      </div>
    </form>
  </template>
</div>
